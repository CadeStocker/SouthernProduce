<!-- filepath: producepricer/templates/view_price_sheet.html -->
{% extends "base.html" %}
{% block title %}Price Sheet – {{ sheet.name }}{% endblock %}
{% block content %}
<div class="container mt-5">
  <a href="{{ url_for('price_sheet') }}" class="btn btn-secondary mb-4">← Back</a>

  <!-- quick‐fill buttons -->
  <div class="d-flex align-items-center mb-4">
    <span class="me-3 text-secondary" style="font-size: 0.95rem;">
      <i class="bi bi-lightning-charge-fill text-warning me-1"></i>
      <strong>Quick Fill Prices By Percentage:</strong>
    </span>
    <div class="btn-group" role="group" aria-label="Quick Fill Percentages">
      {% for pct in [25,30,35,40,45] %}
      <button type="button"
              class="btn btn-outline-primary fill-percent-btn"
              style="min-width: 60px;"
              data-pct="{{ pct }}">
        {{ pct }}%
      </button>
      {% endfor %}
    </div>
  </div>

  <form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="card mb-4">
      <div class="card-header"><strong>Set Prices for {{ sheet.name }}</strong></div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Item</th>
                <th>Choose Price</th>
                <th>
                  Or Enter
                  <br>
                  <small class="text-muted d-block" style="font-weight: normal;">
                    <em>The default is the most recent price.</em>
                  </small>
                </th>
              </tr>
            </thead>
            <tbody>
              {% for item in sheet.items %}
              <tr>
                <td>{{ item.name }}</td>
                <td>
                  <select name="price_select_{{ item.id }}"
                          class="form-control form-control-sm">
                    <option value="">-- select --</option>
                    {% for pct, price in markup_opts[item.id] %}
                    <option value="{{ '%.2f'|format(price) }}">
                      {{ pct }}% – ${{ '%.2f'|format(price) }}
                    </option>
                    {% endfor %}
                  </select>
                </td>
                <td>
                  <input type="text"
                         name="price_input_{{ item.id }}"
                         class="form-control form-control-sm"
                         placeholder="e.g. 12.50"
                         value="{% if recent_prices[item.id] is not none %}{{ '%.2f'|format(recent_prices[item.id]) }}{% endif %}">
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <button type="submit" class="btn btn-primary">Save Prices</button>
  </form>
</div>

<script>
// fill all selects to a given percentage markup
document.querySelectorAll('.fill-percent-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const pctText = btn.dataset.pct + '%';
    document.querySelectorAll('select[name^="price_select_"]').forEach(sel => {
      let found = Array.from(sel.options).find(o => o.text.startsWith(pctText));
      sel.value = found ? found.value : '';
    });
  });
});
</script>
{% endblock %}